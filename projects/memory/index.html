<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„¤ì˜¨ ë©”ëª¨ë¦¬ ë§í¬: ì—ë“€ ì—ë””ì…˜</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-back: #2a2a2a;
            --accent: #00e676;
            --edit-mode: #ff9100;
            --text-main: #e0e0e0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Pretendard', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
        ::-webkit-scrollbar-track { background: #222; }

        h1 { margin-bottom: 20px; font-weight: 700; text-shadow: 0 0 10px var(--accent); }

        .btn {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            margin: 10px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .btn:hover { background: var(--accent); color: #000; box-shadow: 0 0 20px var(--accent); }
        
        .btn-edit { border-color: var(--edit-mode); color: var(--edit-mode); }
        .btn-edit:hover { background: var(--edit-mode); color: #000; box-shadow: 0 0 20px var(--edit-mode); }

        #finish-btn {
            background-color: var(--accent);
            color: #000;
            box-shadow: 0 0 30px var(--accent);
            font-size: 1.3rem;
            padding: 15px 40px;
            animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-top: 20px;
            z-index: 50;
        }
        @keyframes popUp { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .screen.active { display: flex; }

        #start-screen { z-index: 100; text-align: center; }
        .mode-select { display: flex; gap: 20px; margin-top: 30px; }

        #setup-screen { justify-content: flex-start; padding-top: 60px; }
        .setup-container {
            width: 90%; max-width: 800px;
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            background: #1e1e1e;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        .pair-row {
            display: flex; gap: 10px; margin-bottom: 15px; align-items: center;
            background: #252525; padding: 15px; border-radius: 10px;
            animation: fadeIn 0.3s;
        }
        .pair-item { flex: 1; display: flex; flex-direction: column; gap: 5px; }
        .input-group { display: flex; gap: 5px; }
        input[type="text"] {
            flex: 1; padding: 10px; background: #333; border: 1px solid #555;
            color: #fff; border-radius: 5px;
        }
        .file-label {
            padding: 10px; background: #444; border-radius: 5px; cursor: pointer;
            font-size: 0.8rem; text-align: center; border: 1px solid #555; color: #ccc;
        }
        .file-label:hover { background: #555; }
        .preview-box {
            height: 60px; background: #000; border-radius: 5px;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
            border: 1px solid #444;
        }
        .preview-box img { height: 100%; width: auto; }
        .preview-box span { color: #aaa; font-size: 0.8rem; }
        .remove-btn { color: #ff4081; cursor: pointer; font-size: 1.5rem; padding: 0 10px; }

        .status-bar { display: flex; gap: 30px; margin-bottom: 20px; font-size: 1.2rem; }
        .status-item span { font-weight: bold; color: var(--accent); }

        #game-board {
            display: grid; gap: 15px; padding: 20px;
            perspective: 1000px; max-width: 800px; width: 95%; aspect-ratio: 1/1;
        }

        .card {
            background: transparent; cursor: pointer; position: relative;
            transform-style: preserve-3d; transition: transform 0.6s;
            width: 100%; height: 100%;
        }
        .card.flipped { transform: rotateY(180deg); }
        .card.matched { cursor: default; }
        
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); border: 2px solid #333;
            text-align: center; padding: 5px; word-break: keep-all;
        }
        
        .card-front {
            background: var(--card-back);
            background-image: radial-gradient(circle, #333 10%, transparent 10%);
            background-size: 20px 20px;
        }
        .card-front::after { content: '?'; font-size: 2rem; color: #555; font-weight: bold; }

        .card-back {
            background: #000; transform: rotateY(180deg); overflow: hidden;
            font-size: 1.2rem; font-weight: bold; line-height: 1.3;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .card-back img { width: 100%; height: 100%; object-fit: cover; }
        
        /* [ìˆ˜ì •ë¨] ì• ë‹ˆë©”ì´ì…˜ì´ íšŒì „ê°’(rotateY 180deg)ì„ ìœ ì§€í•˜ë„ë¡ ë³€ê²½ */
        .card.matched .card-back {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: rotateY(180deg) scale(1); }
            50% { transform: rotateY(180deg) scale(1.02); }
            100% { transform: rotateY(180deg) scale(1); }
        }

        .hidden { display: none !important; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="start-screen" class="screen active">
        <h1 style="font-size: 3rem;">ğŸ§  NEON MEMORY</h1>
        <p style="color:#aaa;">ìˆ˜ì—… ë°©ì‹ì— ë§ëŠ” ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
        
        <div class="mode-select">
            <button class="btn" onclick="initAutoMode()">
                ğŸ“· ìë™ ë³µì‚¬ ëª¨ë“œ
                <br><span style="font-size:0.7rem; font-weight:normal; text-transform:none;">(ì‚¬ì§„ 1ì¥ â†’ ìë™ 2ì¥)</span>
            </button>
            <button class="btn btn-edit" onclick="initCustomMode()">
                ğŸ§© ì§ì ‘ ì§ì§“ê¸° ëª¨ë“œ
                <br><span style="font-size:0.7rem; font-weight:normal; text-transform:none;">(ê·¸ë¦¼ â†” ê¸€ì, ê·¸ë¦¼ â†” ê·¸ë¦¼)</span>
            </button>
        </div>
        <input type="file" id="folder-input" class="hidden" webkitdirectory multiple>
    </div>

    <div id="setup-screen" class="screen">
        <h2 style="color:var(--edit-mode); margin-bottom:10px;">ë¬¸ì œ ë§Œë“¤ê¸°</h2>
        <p style="color:#aaa; font-size:0.9rem; margin-bottom:20px;">ì™¼ìª½ê³¼ ì˜¤ë¥¸ìª½ì´ ì§ì´ ë©ë‹ˆë‹¤. ê¸€ìë¥¼ ì“°ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦¬ì„¸ìš”.</p>
        
        <div class="setup-container" id="pair-list"></div>

        <div style="display:flex; gap:10px;">
            <button class="btn btn-edit" onclick="addPairRow()">+ ì§ ì¶”ê°€í•˜ê¸°</button>
            <button class="btn" onclick="startCustomGame()">ê²Œì„ ì‹œì‘ â–¶</button>
        </div>
        <button class="btn" style="border:none; color:#777; font-size:0.8rem; margin-top:10px;" onclick="location.reload()">ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="game-screen" class="screen">
        <div class="status-bar">
            <div class="status-item">TIME: <span id="timer">00:00</span></div>
            <div class="status-item">MOVES: <span id="moves">0</span></div>
        </div>
        
        <div id="game-board"></div>

        <button id="finish-btn" class="btn hidden" onclick="showResultScreen()">ğŸ† ê²°ê³¼ ë³´ê¸°</button>
    </div>

    <div id="result-screen" class="screen">
        <h1 style="color: var(--accent); font-size: 3rem;">CLEAR!</h1>
        <p style="font-size: 1.5rem; margin: 20px 0;">
            ì‹œê°„: <span id="final-time" style="color:#fff">00:00</span>
            <br>
            ì´ë™: <span id="final-moves" style="color:#fff">0</span>íšŒ
        </p>
        <button class="btn" onclick="location.reload()">ë©”ì¸ìœ¼ë¡œ</button>
    </div>

    <script>
        let deckData = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let timerInterval;
        let seconds = 0;
        let isLocked = false;

        function getNeonColor() {
            const hue = Math.floor(Math.random() * 360);
            return `hsl(${hue}, 100%, 60%)`;
        }

        function initAutoMode() {
            document.getElementById('folder-input').click();
        }

        document.getElementById('folder-input').addEventListener('change', function(e) {
            const files = Array.from(e.target.files).filter(file => file.type.startsWith('image/'));
            if(files.length < 2) { alert("ìµœì†Œ 2ì¥ì˜ ì´ë¯¸ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤."); return; }
            const selectedFiles = files.slice(0, 10);
            
            deckData = [];
            selectedFiles.forEach((file, index) => {
                const url = URL.createObjectURL(file);
                const pairColor = getNeonColor();
                deckData.push({ id: index, type: 'image', content: url, color: pairColor });
                deckData.push({ id: index, type: 'image', content: url, color: pairColor });
            });
            startGame();
        });

        function initCustomMode() {
            switchScreen('setup-screen');
            if(document.getElementById('pair-list').children.length === 0) {
                addPairRow(); addPairRow();
            }
        }

        function addPairRow() {
            const container = document.getElementById('pair-list');
            const idx = Date.now();
            const row = document.createElement('div');
            row.className = 'pair-row';
            row.innerHTML = `
                <div class="pair-item">
                    <div class="preview-box" id="preview-l-${idx}"><span>Card A</span></div>
                    <div class="input-group">
                        <input type="text" placeholder="ê¸€ì ì…ë ¥" id="text-l-${idx}" oninput="updatePreview(${idx}, 'l')">
                        <label class="file-label">IMG <input type="file" class="hidden" accept="image/*" onchange="handleFileSelect(this, ${idx}, 'l')"></label>
                    </div>
                </div>
                <div style="font-weight:bold; color:#555;">â†”</div>
                <div class="pair-item">
                    <div class="preview-box" id="preview-r-${idx}"><span>Card B</span></div>
                    <div class="input-group">
                        <input type="text" placeholder="ê¸€ì ì…ë ¥" id="text-r-${idx}" oninput="updatePreview(${idx}, 'r')">
                        <label class="file-label">IMG <input type="file" class="hidden" accept="image/*" onchange="handleFileSelect(this, ${idx}, 'r')"></label>
                    </div>
                </div>
                <div class="remove-btn" onclick="this.parentElement.remove()">Ã—</div>
            `;
            container.appendChild(row);
        }

        function handleFileSelect(input, idx, side) {
            const file = input.files[0];
            if (!file) return;
            const url = URL.createObjectURL(file);
            document.getElementById(`preview-${side}-${idx}`).innerHTML = `<img src="${url}">`;
            const textInput = document.getElementById(`text-${side}-${idx}`);
            textInput.value = ''; textInput.placeholder = "ì´ë¯¸ì§€ ì‚¬ìš© ì¤‘";
        }

        function updatePreview(idx, side) {
            const text = document.getElementById(`text-${side}-${idx}`).value;
            const previewBox = document.getElementById(`preview-${side}-${idx}`);
            if(text.trim() === "") previewBox.innerHTML = `<span>Card ${side === 'l' ? 'A' : 'B'}</span>`;
            else previewBox.innerHTML = `<span style="color:#fff; font-size:1.2rem;">${text}</span>`;
        }

        function startCustomGame() {
            const rows = document.querySelectorAll('.pair-row');
            deckData = [];
            rows.forEach((row, index) => {
                const items = row.querySelectorAll('.pair-item');
                if (items.length < 2) return;
                
                const leftItem = items[0], rightItem = items[1];
                const leftImgEl = leftItem.querySelector('.preview-box img');
                const leftTextEl = leftItem.querySelector('input[type="text"]');
                let leftContent = leftImgEl ? leftImgEl.src : leftTextEl.value.trim();
                let leftType = leftImgEl ? 'image' : 'text';

                const rightImgEl = rightItem.querySelector('.preview-box img');
                const rightTextEl = rightItem.querySelector('input[type="text"]');
                let rightContent = rightImgEl ? rightImgEl.src : rightTextEl.value.trim();
                let rightType = rightImgEl ? 'image' : 'text';

                if (leftContent && rightContent) {
                    const pairColor = getNeonColor();
                    deckData.push({ id: index, type: leftType, content: leftContent, color: pairColor });
                    deckData.push({ id: index, type: rightType, content: rightContent, color: pairColor });
                }
            });
            if (deckData.length < 4) { alert("ìµœì†Œ 2ì„¸íŠ¸(4ì¥) ì´ìƒ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
            startGame();
        }

        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function startGame() {
            switchScreen('game-screen');
            document.getElementById('finish-btn').classList.add('hidden');

            deckData.sort(() => Math.random() - 0.5);
            const gameBoard = document.getElementById('game-board');
            let columns = 4;
            if (deckData.length <= 12) columns = 3;
            if (deckData.length >= 20) columns = 5;
            gameBoard.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;

            gameBoard.innerHTML = '';
            deckData.forEach(data => gameBoard.appendChild(createCardElement(data)));

            matchedPairs = 0; moves = 0;
            document.getElementById('moves').innerText = '0';
            startTimer();
        }

        function createCardElement(data) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.id = data.id;
            card.dataset.color = data.color;

            let contentHtml = data.type === 'image' ? `<img src="${data.content}">` : `<span style="font-size:1.5rem; word-break:keep-all;">${data.content}</span>`;
            card.innerHTML = `<div class="card-face card-front"></div><div class="card-face card-back" style="${data.type === 'text' ? 'background:#333;' : ''}">${contentHtml}</div>`;
            card.addEventListener('click', flipCard);
            return card;
        }

        function flipCard() {
            if (isLocked || this.classList.contains('flipped') || this.classList.contains('matched')) return;
            this.classList.add('flipped');
            flippedCards.push(this);
            if (flippedCards.length === 2) {
                moves++;
                document.getElementById('moves').innerText = moves;
                checkForMatch();
            }
        }

        function checkForMatch() {
            isLocked = true;
            const card1 = flippedCards[0];
            const card2 = flippedCards[1];
            const isMatch = card1.dataset.id === card2.dataset.id;

            if (isMatch) {
                setTimeout(() => {
                    const matchColor = card1.dataset.color;
                    
                    applyMatchStyle(card1, matchColor);
                    applyMatchStyle(card2, matchColor);

                    resetFlip();
                    matchedPairs++;
                    
                    if (matchedPairs === deckData.length / 2) {
                        clearInterval(timerInterval);
                        document.getElementById('finish-btn').classList.remove('hidden');
                    }
                }, 500);
            } else {
                setTimeout(() => {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    resetFlip();
                }, 1000);
            }
        }

        function applyMatchStyle(card, color) {
            card.classList.add('matched');
            const backFace = card.querySelector('.card-back');
            backFace.style.borderColor = color;
            backFace.style.boxShadow = `0 0 15px ${color}`;
        }

        function resetFlip() { flippedCards = []; isLocked = false; }

        function startTimer() {
            clearInterval(timerInterval);
            seconds = 0;
            document.getElementById('timer').innerText = "00:00";
            timerInterval = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
                const secs = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${mins}:${secs}`;
            }, 1000);
        }

        function showResultScreen() {
            switchScreen('result-screen');
            document.getElementById('final-time').innerText = document.getElementById('timer').innerText;
            document.getElementById('final-moves').innerText = moves;
        }
    </script>
</body>
</html>